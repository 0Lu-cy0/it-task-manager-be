paths:
  # Dashboard endpoints
  /home/dashboards:
    get:
      tags:
        - Dashboard
      summary: Lấy thống kê tổng quan
      description: Trả về thống kê tổng quan về dự án, task và hoạt động của người dùng
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Thống kê tổng quan
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          totalProjects:
                            type: integer
                            example: 5
                          totalTasks:
                            type: integer
                            example: 23
                          completedTasks:
                            type: integer
                            example: 15
                          pendingTasks:
                            type: integer
                            example: 8
                          projectsByStatus:
                            type: object
                            properties:
                              planning:
                                type: integer
                              in_progress:
                                type: integer
                              testing:
                                type: integer
                              completed:
                                type: integer
                          tasksByPriority:
                            type: object
                            properties:
                              low:
                                type: integer
                              medium:
                                type: integer
                              high:
                                type: integer
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /home/dashboards/recent:
    get:
      tags:
        - Dashboard
      summary: Lấy dự án gần đây
      description: Trả về danh sách các dự án có hoạt động gần đây (3 ngày)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Danh sách dự án gần đây
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          allOf:
                            - $ref: '#/components/schemas/Project'
                            - type: object
                              properties:
                                recentActivity:
                                  type: string
                                  format: date-time
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # Invite endpoints
  /home/invites/{projectId}/inviteLink:
    post:
      tags:
        - Invitations
      summary: Tạo link mời thành viên
      description: Tạo link mời để mời thành viên vào dự án (cần quyền add_member)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role_id
              properties:
                role_id:
                  type: string
                  example: "64f8a1b2c3d4e5f6a7b8c9d0"
                  description: ID vai trò sẽ được gán cho người được mời
                expires_in:
                  type: integer
                  minimum: 1
                  maximum: 168
                  default: 24
                  example: 48
                  description: Thời gian hết hạn link (giờ)
      responses:
        '201':
          description: Link mời được tạo thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          inviteToken:
                            type: string
                            example: "inv_abc123def456"
                          inviteLink:
                            type: string
                            example: "http://localhost:3000/invite/inv_abc123def456"
                          expiresAt:
                            type: string
                            format: date-time
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '429':
          description: Quá nhiều lời mời được tạo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /home/invites/{token}:
    get:
      tags:
        - Invitations
      summary: Xử lý link mời
      description: Xử lý khi người dùng click vào link mời và tham gia dự án
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
          description: Token của lời mời
      responses:
        '200':
          description: Tham gia dự án thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          project:
                            $ref: '#/components/schemas/Project'
                          role:
                            type: object
                            properties:
                              _id:
                                type: string
                              name:
                                type: string
        '400':
          description: Token không hợp lệ hoặc đã hết hạn
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '409':
          description: Người dùng đã là thành viên của dự án
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Project Roles endpoints
  /home/project-roles/{projectId}/roles/{roleId}/permissions:
    get:
      tags:
        - Project Roles
      summary: Lấy danh sách quyền của vai trò
      description: Trả về danh sách quyền hạn của một vai trò trong dự án
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
        - in: path
          name: roleId
          required: true
          schema:
            type: string
          description: ID của vai trò
      responses:
        '200':
          description: Danh sách quyền hạn
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            name:
                              type: string
                            description:
                              type: string
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    post:
      tags:
        - Project Roles
      summary: Thêm quyền cho vai trò
      description: Thêm quyền hạn mới cho vai trò (cần quyền edit_permission_role và Free Mode)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
        - in: path
          name: roleId
          required: true
          schema:
            type: string
          description: ID của vai trò
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - permission_id
              properties:
                permission_id:
                  type: string
                  example: "64f8a1b2c3d4e5f6a7b8c9d0"
      responses:
        '200':
          description: Thêm quyền thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Không có quyền hoặc Free Mode chưa được bật
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'

  /home/project-roles/{projectId}/roles/{roleId}/permissions/{permissionId}:
    delete:
      tags:
        - Project Roles
      summary: Xóa quyền khỏi vai trò
      description: Loại bỏ quyền hạn khỏi vai trò (cần quyền edit_permission_role và Free Mode)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
        - in: path
          name: roleId
          required: true
          schema:
            type: string
          description: ID của vai trò
        - in: path
          name: permissionId
          required: true
          schema:
            type: string
          description: ID của quyền hạn
      responses:
        '200':
          description: Xóa quyền thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          description: Không có quyền hoặc Free Mode chưa được bật
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFoundError'

  # Search endpoints
  /home/search:
    get:
      tags:
        - Search
      summary: Tìm kiếm toàn cục
      description: Tìm kiếm trên tất cả dự án, task và người dùng
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: q
          required: true
          schema:
            type: string
            minLength: 1
          description: Từ khóa tìm kiếm
          example: "design"
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          description: Số lượng kết quả tối đa
      responses:
        '200':
          description: Kết quả tìm kiếm
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          projects:
                            type: array
                            items:
                              $ref: '#/components/schemas/Project'
                          tasks:
                            type: array
                            items:
                              $ref: '#/components/schemas/Task'
                          users:
                            type: array
                            items:
                              $ref: '#/components/schemas/User'
                          total:
                            type: integer
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /home/search/projects:
    get:
      tags:
        - Search
      summary: Tìm kiếm dự án
      description: Tìm kiếm chỉ trong các dự án
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: q
          required: true
          schema:
            type: string
            minLength: 1
          description: Từ khóa tìm kiếm
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          description: Số lượng kết quả tối đa
      responses:
        '200':
          description: Kết quả tìm kiếm dự án
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Project'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /home/search/tasks:
    get:
      tags:
        - Search
      summary: Tìm kiếm task
      description: Tìm kiếm chỉ trong các task
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: q
          required: true
          schema:
            type: string
            minLength: 1
          description: Từ khóa tìm kiếm
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          description: Số lượng kết quả tối đa
      responses:
        '200':
          description: Kết quả tìm kiếm task
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Task'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /home/search/users:
    get:
      tags:
        - Search
      summary: Tìm kiếm người dùng
      description: Tìm kiếm người dùng trong hệ thống
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: q
          required: true
          schema:
            type: string
            minLength: 1
          description: Từ khóa tìm kiếm
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 10
          description: Số lượng kết quả tối đa
      responses:
        '200':
          description: Kết quả tìm kiếm người dùng
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  # Notification endpoints
  /home/noti:
    get:
      tags:
        - Notifications
      summary: Lấy tất cả thông báo
      description: Trả về danh sách thông báo của người dùng hiện tại
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 50
            default: 20
          description: Số lượng thông báo per page
        - in: query
          name: is_read
          schema:
            type: boolean
          description: Lọc theo trạng thái đã đọc/chưa đọc
      responses:
        '200':
          description: Danh sách thông báo
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Notification'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

    delete:
      tags:
        - Notifications
      summary: Xóa tất cả thông báo đã đọc
      description: Xóa tất cả thông báo đã được đánh dấu là đã đọc
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /home/noti/{notiId}:
    get:
      tags:
        - Notifications
      summary: Lấy chi tiết thông báo
      description: Trả về thông tin chi tiết của một thông báo
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: notiId
          required: true
          schema:
            type: string
          description: ID của thông báo
      responses:
        '200':
          description: Chi tiết thông báo
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Notification'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    patch:
      tags:
        - Notifications
      summary: Đánh dấu đã đọc
      description: Đánh dấu thông báo là đã đọc
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: notiId
          required: true
          schema:
            type: string
          description: ID của thông báo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - is_read
              properties:
                is_read:
                  type: boolean
                  example: true
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Notification'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'

    delete:
      tags:
        - Notifications
      summary: Xóa thông báo
      description: Xóa một thông báo cụ thể
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: notiId
          required: true
          schema:
            type: string
          description: ID của thông báo
      responses:
        '200':
          description: Xóa thành công
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          $ref: '#/components/responses/NotFoundError'