paths:
  /home/projects:
    get:
      tags:
        - Projects
      summary: Lấy danh sách dự án
      description: Trả về danh sách tất cả dự án mà người dùng tham gia
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Số trang
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Số lượng item per page
        - in: query
          name: status
          schema:
            type: string
            enum: [planning, in_progress, testing, completed]
          description: Lọc theo trạng thái dự án
        - in: query
          name: priority
          schema:
            type: string
            enum: [low, medium, high]
          description: Lọc theo độ ưu tiên
      responses:
        "200":
          description: Danh sách dự án
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          projects:
                            type: array
                            items:
                              $ref: "#/components/schemas/Project"
                          pagination:
                            type: object
                            properties:
                              page:
                                type: integer
                              limit:
                                type: integer
                              total:
                                type: integer
                              totalPages:
                                type: integer
        "401":
          $ref: "#/components/responses/UnauthorizedError"

    post:
      tags:
        - Projects
      summary: Tạo dự án mới
      description: Tạo một dự án mới với người tạo làm Owner
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - status
                - priority
              properties:
                name:
                  type: string
                  minLength: 5
                  maxLength: 50
                  example: "Website Redesign Project"
                description:
                  type: string
                  example: "Complete redesign of company website with modern UI/UX"
                status:
                  type: string
                  enum: [planning, in_progress, testing, completed]
                  example: "planning"
                priority:
                  type: string
                  enum: [low, medium, high]
                  example: "high"
                start_date:
                  type: string
                  format: date
                  example: "2024-01-15"
                end_date:
                  type: string
                  format: date
                  example: "2024-03-15"
      responses:
        "201":
          description: Dự án được tạo thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Project"
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"

  /home/projects/{projectId}:
    get:
      tags:
        - Projects
      summary: Lấy chi tiết dự án
      description: Trả về thông tin chi tiết của một dự án
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
      responses:
        "200":
          description: Chi tiết dự án
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Project"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

    put:
      tags:
        - Projects
      summary: Cập nhật dự án
      description: Cập nhật thông tin dự án (cần quyền edit_project)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 5
                  maxLength: 50
                  example: "Updated Project Name"
                description:
                  type: string
                  example: "Updated project description"
                status:
                  type: string
                  enum: [planning, in_progress, testing, completed]
                  example: "in_progress"
                priority:
                  type: string
                  enum: [low, medium, high]
                  example: "medium"
                start_date:
                  type: string
                  format: date
                  example: "2024-01-20"
                end_date:
                  type: string
                  format: date
                  example: "2024-04-15"
      responses:
        "200":
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiResponse"
                  - type: object
                    properties:
                      data:
                        $ref: "#/components/schemas/Project"
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

    delete:
      tags:
        - Projects
      summary: Xóa dự án
      description: Xóa mềm dự án (cần quyền delete_project)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
      responses:
        "200":
          description: Xóa thành công
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  /home/projects/{projectId}/members/{userId}:
    delete:
      tags:
        - Projects
      summary: Xóa thành viên khỏi dự án
      description: Loại bỏ một thành viên khỏi dự án (cần quyền can_add_member)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
        - in: path
          name: userId
          required: true
          schema:
            type: string
          description: ID của người dùng cần xóa
      responses:
        "200":
          description: Xóa thành viên thành công
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiResponse"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  /home/projects/{projectId}/roles:
    get:
      tags:
        - Projects
      summary: Lấy danh sách vai trò trong dự án
      description: Trả về danh sách tất cả vai trò và quyền hạn trong dự án
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
      responses:
        "200":
          description: Danh sách vai trò
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiResponse"
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            name:
                              type: string
                              enum: [owner, lead, member]
                            permissions:
                              type: array
                              items:
                                type: object
                                properties:
                                  _id:
                                    type: string
                                  name:
                                    type: string
                                  description:
                                    type: string
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

    put:
      tags:
        - Projects
      summary: Cập nhật vai trò thành viên
      description: Thay đổi vai trò của một hoặc nhiều thành viên (cần quyền change_member_role)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - updates
              properties:
                updates:
                  type: array
                  items:
                    type: object
                    required:
                      - user_id
                      - new_role_id
                    properties:
                      user_id:
                        type: string
                        example: "64f8a1b2c3d4e5f6a7b8c9d0"
                      new_role_id:
                        type: string
                        example: "64f8a1b2c3d4e5f6a7b8c9d1"
      responses:
        "200":
          description: Cập nhật vai trò thành công
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiResponse"
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          $ref: "#/components/responses/ForbiddenError"
        "404":
          $ref: "#/components/responses/NotFoundError"

  /home/projects/{projectId}/free-mode:
    patch:
      tags:
        - Projects
      summary: Bật/tắt Free Mode
      description: Cho phép Owner tùy chỉnh quyền hạn không giới hạn (chỉ Owner mới có thể sử dụng)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: projectId
          required: true
          schema:
            type: string
          description: ID của dự án
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - free_mode
              properties:
                free_mode:
                  type: boolean
                  example: true
      responses:
        "200":
          description: Cập nhật Free Mode thành công
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiResponse"
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          free_mode:
                            type: boolean
        "400":
          $ref: "#/components/responses/ValidationError"
        "401":
          $ref: "#/components/responses/UnauthorizedError"
        "403":
          description: Chỉ Owner mới có thể thay đổi Free Mode
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          $ref: "#/components/responses/NotFoundError"
